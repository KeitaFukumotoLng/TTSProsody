timeline.push({
    type: jsPsychHtmlKeyboardResponse,
    stimulus: "データを照合しています。少々お待ちください...",
    choices: "NO_KEYS",
    on_start: function () {
        const subject_id = jsPsych.data.get().last(1).values()[0].subject_id;
        const task1_url = "https://script.google.com/macros/s/AKfycbxYgoaPPcYSgk4DbrdUlSaFO438JnQ2Cev3Olg1MDvkG_NTQLpcXfxWhNBXZb_WKQ-qQg/exec";

        fetch(`${task1_url}?id=${subject_id}`)
            .then(res => res.json())
            .then(resData => {
                if (resData.exposed_nums && resData.exposed_nums.length > 0) {
                    task1_exposed_nums = resData.exposed_nums;
                    jsPsych.finishTrial();
                } else {
                    throw new Error("IDに対応する先日のデータが見つかりません。");
                }
            })
            .catch(e => {
                document.body.innerHTML =
                    `<div style="text-align:center; margin-top:50px; color:red;">
                        <h2>エラー</h2><p>${e.message}</p>
                     </div>`;
            });
    }
});
